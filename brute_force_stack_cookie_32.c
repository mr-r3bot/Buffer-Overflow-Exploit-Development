#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>

int main(int argc, char* argv[]) {
    pid_t pid = fork(); //Fork a child process
    int fdin[2];
    int fdout[2];
    if (pid == -1) exit(1);
    // Create a pipe communicate between parent and child process
    pipe(fdin);
    pipe(fdout);

    if (!pid) {
        // Child
        dup2(fdin[0], STDIN_FILENO);
        dup2(fdout[1], STDOUT_FILENO);

        close(fdin[0]);
        close(fdout[1]);

        char *exec_argv[] = {"./stack0_32", 0};
        execv(exec_argv[0], exec_argv);
    } else {
        // Parent
        unsigned char exploit_input[] = {};
        close(fdin[0]);
        close(fdout[1]);
        write(fdin[1], exploit_input, sizeof(exploit_input));
        wait(NULL);
        char buffer[256];
        read(fdout[0], buffer, sizeof(buffer));
        printf("output: %s\n", buffer);
    }
}